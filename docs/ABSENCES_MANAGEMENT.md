# üìÖ Gestion des Absences Exceptionnelles - SmartPlanning

## Vue d'ensemble

La gestion des absences exceptionnelles dans SmartPlanning permet aux utilisateurs de d√©clarer et de g√©rer facilement les absences de leurs employ√©s lors de la g√©n√©ration de plannings IA. Cette fonctionnalit√©, introduite dans la version 1.7.0, offre une interface intuitive et compl√®te pour tous les types d'absences.

**Version** : 2.2.1 (Ao√ªt 2025)  
**Status** : ‚úÖ Production d√©ploy√©e - https://smartplanning.fr  
**Int√©gration** : Wizard IA Planning - √âtape 3 (Absences)  
**Support** : Absences multiples par employ√© avec validation avanc√©e

## üéØ Fonctionnalit√©s Principales

### Types d'Absences Support√©s

- **üè• Maladie** : Absence compl√®te pour raison m√©dicale (`sick`)
- **üèñÔ∏è Cong√©s** : Absence pr√©vue pour vacances ou repos (`vacation`)
- **üìö Formation** : Absence pour formation professionnelle (`training`)
- **üö´ Indisponible** : Absence pour raison personnelle (`unavailable`)
- **‚è∞ Horaires r√©duits** : Travail partiel selon pr√©f√©rences (`reduced`)

### Capacit√©s Avanc√©es

- **üîÑ Absences multiples** : Plusieurs absences par employ√© avec gestion individuelle
- **üìÖ Validation avanc√©e** : Correspondance dates de semaine planifi√©e
- **üí¨ Descriptions** : Raison et contexte pour chaque absence (optionnel)
- **üé® Interface moderne** : Design glassmorphism avec animations Framer Motion
- **‚ö° Int√©gration temps r√©el** : Prise en compte imm√©diate dans la g√©n√©ration IA
- **üîß Moteur optimis√©** : G√©n√©ration 2-5ms avec AdvancedSchedulingEngine

## üìã Guide d'Utilisation

### Acc√®s √† la Gestion des Absences

1. **Navigation** : Acc√©dez au Planning Wizard IA depuis le dashboard
2. **√âtape 3** : "Absences" (optionnelle) apr√®s s√©lection des employ√©s  
3. **Interface** : Vue par employ√© avec cartes d'absence color√©es par type
4. **URL** : https://smartplanning.fr/planning-wizard (√©tape 3)

### Ajouter une Absence

1. **S√©lection employ√©** : Choisissez l'employ√© concern√©
2. **Bouton "Ajouter une absence"** : Cliquez sur le bouton + avec bordure pointill√©e
3. **Formulaire** : Remplissez les informations :
   - **Type d'absence** : Cong√©s, Maladie, Formation, Indisponible, Horaires r√©duits
   - **Date d'absence** : S√©lecteur de date avec validation
   - **Description** : Contexte optionnel (ex: "Rendez-vous m√©dical")
4. **Validation** : L'absence est ajout√©e imm√©diatement

### G√©rer Plusieurs Absences

1. **Ajout multiple** : Cliquez plusieurs fois sur "Ajouter une absence"
2. **Cartes individuelles** : Chaque absence a sa propre carte rouge
3. **Num√©rotation** : Absence #1, #2, etc. pour identification
4. **Suppression** : Bouton corbeille pour supprimer une absence

### Modification d'une Absence

1. **S√©lection** : Cliquez sur la carte de l'absence √† modifier
2. **Modification** : Changez type, date ou commentaire
3. **Sauvegarde** : Automatique lors du changement
4. **Suppression** : Bouton corbeille en haut √† droite

## üîß Architecture Technique

### Frontend (React + TypeScript)

```typescript
interface EmployeeException {
  date: string; // Format ISO (YYYY-MM-DD)
  type: 'vacation' | 'sick' | 'unavailable' | 'training' | 'reduced';
  description?: string; // Optionnel
}

interface EmployeeConstraint {
  id: string;
  name: string;
  email: string;
  exceptions?: EmployeeException[];
  // ... autres propri√©t√©s
}

// √âtat des absences dans le composant
const [employeeExceptions, setEmployeeExceptions] = useState<{
  [key: string]: EmployeeException[]
}>({});
```

### Backend (AdvancedSchedulingEngine)

```typescript
// Validation des exceptions dans le moteur de planification
function isEmployeeAvailable(employee: Employee, date: Date): boolean {
  // V√©rifier les exceptions (cong√©s, absences)
  const hasBlockingException = employee.exceptions?.some(exception => {
    const exceptionDate = new Date(exception.date);
    const isSameDate = exceptionDate.toDateString() === date.toDateString();
    const isBlockingType = ['vacation', 'sick', 'unavailable'].includes(exception.type);
    
    return isSameDate && isBlockingType;
  });

  return !hasBlockingException;
}

// Gestion des horaires r√©duits
const hasReducedHours = employee.exceptions?.some(exception => {
  const exceptionDate = new Date(exception.date);
  return exceptionDate.toDateString() === date.toDateString() && 
         exception.type === 'reduced';
});

// Types support√©s dans le backend
interface EmployeeException {
  date: string; // ISO format (YYYY-MM-DD)
  type: 'vacation' | 'sick' | 'unavailable' | 'training' | 'reduced';
  description?: string;
}
```

## üé® Interface Utilisateur

### Design System

**Couleurs principales** :
- **Fond** : `bg-red-50 dark:bg-red-900/20`
- **Bordures** : `border-red-200 dark:border-red-700/50`
- **Texte** : `text-red-700 dark:text-red-300`
- **Boutons** : `text-red-600 dark:text-red-400`

### Animations

```typescript
// Animation d'apparition des cartes d'absence
const cardAnimation = {
  initial: { opacity: 0, scale: 0.9 },
  animate: { opacity: 1, scale: 1 },
  transition: { delay: exceptionIndex * 0.1 }
};

// Animation des boutons
const buttonAnimation = {
  whileHover: { scale: 1.02 },
  whileTap: { scale: 0.98 }
};
```

### Responsive Design

- **Desktop** : Grille 2 colonnes pour type/date
- **Mobile** : Colonnes empil√©es
- **Tablette** : Adaptation automatique selon l'espace

## üîÑ Logique de G√©n√©ration

### Traitement des Absences (AdvancedSchedulingEngine)

1. **Validation des dates** : Correspondance avec la semaine planifi√©e
2. **Classification des exceptions** :
   - **Blocantes** : `vacation`, `sick`, `unavailable` ‚Üí aucun cr√©neau
   - **Formation** : `training` ‚Üí trait√© comme blocant
   - **Partielles** : `reduced` ‚Üí horaires adapt√©s selon pr√©f√©rences
3. **G√©n√©ration intelligente** : Adaptation automatique des cr√©neaux
4. **Performance** : Validation en 2-5ms par employ√©

### Logs et Debugging (Production)

```typescript
// Logs de diagnostic dans le moteur de planification
console.log(`üö´ ${employee._id} - exception le ${day}:`, exception.type);
console.log(`‚è∞ ${employee.firstName} ${employee.lastName} - horaires adapt√©s`);

// Monitoring des exceptions
if (process.env.NODE_ENV === 'development') {
  console.log(`üìä Total exceptions trait√©es: ${processedExceptions.length}`);
}
```

## üìä Exemples d'Utilisation

### Cas d'Usage Typiques

1. **Employ√© malade** :
   - Type : "Maladie" (`sick`)
   - Date : Jour de l'absence
   - Description : "Grippe - arr√™t m√©dical"

2. **Cong√©s programm√©s** :
   - Type : "Cong√©s" (`vacation`)
   - Date : Jour de cong√©
   - Description : "Vacances d'√©t√©"

3. **Formation professionnelle** :
   - Type : "Formation" (`training`)
   - Date : Jour de formation
   - Description : "Formation obligatoire s√©curit√©"

4. **Rendez-vous m√©dical** :
   - Type : "Horaires r√©duits" (`reduced`)
   - Date : Jour du rendez-vous
   - Description : "RDV m√©dical 14h"

### Absences Multiples

```typescript
// Exemple d'employ√© avec plusieurs absences
const employeeWithMultipleAbsences = {
  id: "employee123",
  name: "Marie Dupont",
  exceptions: [
    {
      date: "2025-08-21",
      type: "sick",
      description: "Grippe saisonni√®re"
    },
    {
      date: "2025-08-23",
      type: "reduced",
      description: "RDV sp√©cialiste apr√®s-midi"
    },
    {
      date: "2025-08-25",
      type: "vacation",
      description: "Cong√©s d'√©t√© - derni√®re semaine"
    }
  ]
};
```

## üöÄ √âtat Actuel et Futures Am√©liorations

### Version 2.2.1 - Production (Ao√ªt 2025)

**‚úÖ Fonctionnalit√©s Actuelles :**
- Gestion compl√®te des 5 types d'absences
- Interface intuitive dans le Planning Wizard  
- Int√©gration parfaite avec AdvancedSchedulingEngine (2-5ms)
- Support absences multiples par employ√©
- Validation temps r√©el avec g√©n√©ration imm√©diate

### Version 2.3.0 (Q4 2025) - Planifi√©

- **üìä Dashboard absences** : Vue globale par √©quipe/p√©riode
- **üì± Notifications avanc√©es** : Alertes conflits et validations
- **üîÑ Templates d'absences** : Mod√®les r√©currents (RTT, formations)
- **üìà Analytics** : Statistiques et tendances d'absences

### Version 2.4.0 (Q1 2026) - Roadmap

- **üìÖ Int√©gration calendrier** : Sync bidirectionnelle Google/Outlook
- **ü§ñ IA pr√©dictive** : Suggestions intelligentes d'absences probables
- **üîó API RH** : Int√©gration syst√®mes RH existants (Workday, BambooHR)
- **üì± App mobile** : Gestion nomade des absences

## üõ†Ô∏è D√©veloppement et Maintenance

### Tests

```typescript
// Tests unitaires pour la gestion des absences
describe('Absence Management', () => {
  test('should add new absence to employee', () => {
    // Test d'ajout d'absence
  });
  
  test('should validate absence dates', () => {
    // Test de validation des dates
  });
  
  test('should handle multiple absences', () => {
    // Test d'absences multiples
  });
});
```

### Configuration Actuelle (AbsencesStep.tsx)

```typescript
// Types d'absences avec th√®me adaptatif
const getExceptionTypes = (isDarkMode: boolean) => [
  { 
    value: 'vacation', 
    label: 'Cong√©s', 
    color: 'bg-blue-500', 
    bgColor: isDarkMode ? 'bg-blue-900/30' : 'bg-blue-50'
  },
  { 
    value: 'sick', 
    label: 'Maladie', 
    color: 'bg-red-500',
    bgColor: isDarkMode ? 'bg-red-900/30' : 'bg-red-50'
  },
  { 
    value: 'training', 
    label: 'Formation', 
    color: 'bg-green-500',
    bgColor: isDarkMode ? 'bg-green-900/30' : 'bg-green-50'
  },
  // ... autres types
];
```

## üìö Ressources Compl√©mentaires

- **[Guide utilisateur](AI_ASSISTANT.md)** : Utilisation compl√®te du wizard IA
- **[API Documentation](API.md)** : Endpoints et sch√©mas
- **[Architecture](ARCHITECTURE.md)** : Vue d'ensemble technique
- **[D√©veloppement](DEVELOPMENT.md)** : Configuration locale

---

**üìû Support** : Documentation compl√®te disponible, application d√©ploy√©e sur https://smartplanning.fr

**üéØ Objectif** : Gestion intuitive des absences pour des plannings IA ultra-pr√©cis et une satisfaction employ√© optimale

**üìä Performance** : AdvancedSchedulingEngine - G√©n√©ration 2-5ms avec prise en compte compl√®te des absences  
**üöÄ Production** : Syst√®me stable et op√©rationnel en production (Version 2.2.1)